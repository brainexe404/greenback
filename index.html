<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Baron Greenback ($GBARON)</title>

  <meta name="theme-color" content="#070b10" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    html,body{height:100%;margin:0;background:#070b10}
  </style>

  <script>
    (function () {
      // If you want a stable "version", set BUILD to "1001" etc.
      // If you want "always latest no matter what", keep Date.now().
      var BUILD = String(Date.now());

      var MOBILE_MAX = 900;

      function isMobile(){
        var w = Math.min(window.innerWidth || 9999, screen.width || 9999);
        return (
          w <= MOBILE_MAX ||
          /Android|iPhone|iPad|iPod/i.test(navigator.userAgent)
        );
      }

      function targetPage(){
        return isMobile() ? "mobile.html" : "desktop.html";
      }

      // --- One-time hard purge of SW + caches to stop "stuck" builds ---
      // Runs once per device, then never again (unless you clear site data).
      async function oneTimePurge(){
        try{
          var key = "gbaron_purged_v1";
          if (sessionStorage.getItem(key) === "1") return;

          // Unregister service workers
          if ("serviceWorker" in navigator && navigator.serviceWorker.getRegistrations){
            var regs = await navigator.serviceWorker.getRegistrations();
            await Promise.all(regs.map(function(r){ return r.unregister(); }));
          }

          // Clear Cache Storage
          if (window.caches && caches.keys){
            var names = await caches.keys();
            await Promise.all(names.map(function(n){ return caches.delete(n); }));
          }

          sessionStorage.setItem(key, "1");
        }catch(e){
          // ignore
        }
      }

      function mount(){
        var f = document.getElementById("app");
        if (!f) return;
        // Cache-bust the page itself (mobile/desktop). URL stays clean because it's inside iframe.
        f.src = targetPage() + "?v=" + encodeURIComponent(BUILD);
      }

      // Boot
      (async function(){
        // Purge once to kill the “mobile.html only works with ?v=999” issue
        await oneTimePurge();
        mount();

        // Optional: re-route on resize/orientation change
        var rt = null;
        window.addEventListener("resize", function(){
          clearTimeout(rt);
          rt = setTimeout(mount, 250);
        });
      })();
    })();
  </script>
</head>

<body>
  <!-- URL stays "greenback.wtf" because we mount the real page in an iframe -->
  <iframe
    id="app"
    title="Baron Greenback"
    style="position:fixed;inset:0;width:100%;height:100%;border:0;background:#070b10"
    referrerpolicy="no-referrer"
  ></iframe>

  <noscript>
    <div style="min-height:100%;display:grid;place-items:center;color:#eaf2ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;padding:24px;text-align:center">
      <div style="width:min(520px,92vw);border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);padding:18px">
        <div style="font-weight:900;font-size:18px;letter-spacing:.2px;margin-bottom:6px">JavaScript disabled</div>
        <div style="color:#93a4c7;font-size:14px;line-height:1.4">
          Open manually:<br>
          <a href="mobile.html" style="color:#c8ff2f;font-weight:800;text-decoration:none">mobile</a> ·
          <a href="desktop.html" style="color:#c8ff2f;font-weight:800;text-decoration:none">desktop</a>
        </div>
      </div>
    </div>
  </noscript>
</body>
</html>
