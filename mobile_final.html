<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Baron Greenback ($GBARON) â€” Mobile</title>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
  *,*::before,*::after{box-sizing:border-box}
  :root{
    --bg:#070b10;
    --panel:#0d1320;
    --panel2:#0b111c;
    --text:#eaf2ff;
    --muted:#93a4c7;
    --line:rgba(255,255,255,.10);
    --good:#2dff6a;
    --warn:#c8ff2f;
    --bad:#ff4d6d;
    --shadow: 0 14px 40px rgba(0,0,0,.55);
    --r:18px;
    --mono: ui-monospace, Menlo, Consolas, "SF Mono", monospace;
  }

  html,body{height:100%; margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background:
      radial-gradient(900px 520px at 20% -10%, rgba(110,231,255,.16), transparent 55%),
      radial-gradient(700px 420px at 85% 10%, rgba(167,139,250,.16), transparent 60%),
      radial-gradient(700px 420px at 50% 110%, rgba(45,255,106,.10), transparent 60%),
      var(--bg);
    color:var(--text);
    overflow-x:hidden;
  }

  /* subtle CRT overlay */
  body::before{
    content:"";position:fixed;inset:0;pointer-events:none;z-index:2;
    background:repeating-linear-gradient(to bottom, rgba(255,255,255,.05) 0 1px, rgba(0,0,0,0) 3px 6px);
    opacity:.07;mix-blend-mode:overlay;
  }

  .stage{
    min-height:100dvh;
    padding:12px;
    padding-top:calc(12px + env(safe-area-inset-top));
    padding-bottom:calc(12px + env(safe-area-inset-bottom));
    display:flex;
    justify-content:center;
    position:relative;
    z-index:5;
  }

  .frame{
    width:100%;
    max-width:560px;
    border-radius:24px;
    border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    box-shadow:var(--shadow);
    overflow:hidden;
  }

  /* HEADER */
  .header{
    padding:10px;
    border-bottom:1px solid var(--line);
    background:rgba(0,0,0,.22);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .brandLink{
    display:flex;align-items:center;gap:10px;min-width:0;
    text-decoration:none;color:inherit;
    padding:6px;border-radius:14px;
  }
  .brandLink:focus-visible{outline:2px solid rgba(110,231,255,.65); outline-offset:2px}
  .avatar{
    width:40px;height:40px;border-radius:12px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    overflow:hidden;flex:0 0 auto;
  }
  .avatar img{width:100%;height:100%;object-fit:cover;image-rendering:pixelated}
  .brandText{min-width:0;display:flex;flex-direction:column;gap:2px}
  .title{
    font-weight:1000;font-size:15px;line-height:1.05;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    letter-spacing:.2px;
  }
  .sub{
    font-size:11px;color:var(--muted);
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }

  .soundPill{
    display:flex;align-items:center;gap:8px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    padding:8px 10px;border-radius:14px;
    flex:0 0 auto;
  }
  .soundLabel{font-family:var(--mono);font-size:11px;color:var(--muted);font-weight:900;letter-spacing:.3px}
  .soundToggle{
    height:30px;width:50px;border-radius:999px;border:1px solid var(--line);
    background:rgba(0,0,0,.20);position:relative;cursor:pointer;user-select:none;
  }
  .soundToggle::after{
    content:"";position:absolute;top:3px;left:3px;width:24px;height:24px;border-radius:999px;
    background:rgba(255,255,255,.10);border:1px solid var(--line);
    transition:transform .16s ease, background .16s ease;
  }
  .soundToggle.on::after{transform:translateX(20px); background:rgba(45,255,106,.20)}

  .content{
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .card{
    border:1px solid var(--line);
    background:rgba(0,0,0,.22);
    border-radius:18px;
    overflow:hidden;
  }

  /* STATS */
  .stats{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    padding:10px;
  }
  .pill{
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:9px 10px;
  }
  .k{font-size:10px;color:var(--muted);letter-spacing:.5px;font-weight:900}
  .v{
    margin-top:2px;
    font-family:var(--mono);
    font-weight:1000;
    font-size:16px;
    display:flex;align-items:baseline;gap:8px;
    white-space:nowrap;
  }

  /* PRICE ROW: left has price + pct, right has spark */
  .priceWrap{padding:0 10px 10px}
  .priceRow{
    display:grid;
    grid-template-columns: 1fr 118px;
    gap:10px;
    align-items:center;
    margin-top:4px;
  }
  .priceLeft{
    min-width:0;
    display:flex;
    align-items:baseline;
    gap:10px;
    white-space:nowrap;
  }
  .priceBig{
    font-family:var(--mono);
    font-weight:1000;
    font-size:28px;
    letter-spacing:.2px;
  }
  .pct{
    font-size:11px;font-weight:1000;
    padding:3px 8px;border-radius:999px;border:1px solid var(--line);
    background:rgba(45,255,106,.10);
    color:var(--good);
    font-family:var(--mono);
    flex:0 0 auto;
  }
  .sparkBox{
    height:44px;border-radius:14px;border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(110,231,255,.10), rgba(0,0,0,0));
    overflow:hidden;position:relative;
  }
  .sparkBox svg{width:100%;height:100%}
  .sparkGlow{
    position:absolute;inset:0;pointer-events:none;
    background:radial-gradient(240px 90px at 75% 45%, rgba(110,231,255,.20), transparent 62%);
    opacity:.75;mix-blend-mode:screen;
  }
  .note{
    margin-top:6px;
    color:var(--muted);
    font-size:11px;
    line-height:1.35;
  }

  /* BUTTONS */
  .actions{
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .btnRow{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  .btn{
    appearance:none;border:none;border-radius:16px;
    padding:14px 12px;
    font-weight:1000;letter-spacing:.3px;
    cursor:pointer;
    color:#fff;
    border:1px solid var(--line);
    background:rgba(255,255,255,.06);
    display:flex;align-items:center;justify-content:center;gap:10px;
    user-select:none;-webkit-tap-highlight-color: transparent;
    transition:transform .06s ease, filter .2s ease;
  }
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn:disabled{opacity:.65; cursor:not-allowed}

  .btn.insert{
    background:linear-gradient(135deg, rgba(45,255,106,1), rgba(45,255,106,.74));
    border-color:rgba(45,255,106,.55);
    box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 22px rgba(45,255,106,.14);
  }
  /* subtle pulse only for INSERT */
  .btn.insert.pulse{
    animation: insertPulse 2.1s ease-in-out infinite;
  }
  @keyframes insertPulse{
    0%,100%{filter:brightness(1)}
    50%{filter:brightness(1.10)}
  }

  .btn.degen{
    background:linear-gradient(135deg, rgba(200,255,47,1), rgba(200,255,47,.78));
    border-color:rgba(200,255,47,.55);
    box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 22px rgba(200,255,47,.16);
    color:#fff; /* keep white */
    text-shadow:0 1px 0 rgba(0,0,0,.55);
  }
  .btn.rug{
    background:linear-gradient(135deg, rgba(255,77,109,.22), rgba(255,176,0,.10));
    border-color:rgba(255,77,109,.28);
  }

  .ico{
    width:22px;height:22px;
    image-rendering:pixelated;
    filter:drop-shadow(0 0 10px rgba(255,255,255,.14));
  }
  .emoji{font-size:18px;line-height:1}

  /* CA */
  .caWrap{padding:10px}
  .caBtn{
    width:100%;
    text-align:left;
    border-radius:16px;
    border:1px solid rgba(200,255,47,.22);
    background:
      radial-gradient(800px 220px at 10% 30%, rgba(200,255,47,.18), transparent 45%),
      radial-gradient(700px 220px at 90% 60%, rgba(45,255,106,.10), transparent 45%),
      rgba(255,255,255,.04);
    padding:12px 12px;
    cursor:pointer;
    color:var(--text);
    position:relative;
    overflow:hidden;
    box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset, 0 0 24px rgba(200,255,47,.10);
    user-select:none;-webkit-tap-highlight-color: transparent;
  }
  .caBtn:active{transform:translateY(1px) scale(.995)}
  .caTop{
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    font-family:var(--mono);font-weight:1000;letter-spacing:.7px;font-size:11px;text-transform:uppercase;
    color:rgba(255,255,255,.78);
    margin-bottom:8px;
  }
  .caBig{
    font-family:var(--mono);
    font-weight:1000;
    font-size:14px;
    letter-spacing:.2px;
    line-height:1.25;
    overflow-wrap:anywhere;
  }
  .tapHint{
    margin-top:8px;
    font-family:var(--mono);
    font-size:11px;
    color:var(--muted);
    letter-spacing:.2px;
    text-transform:uppercase;
  }
  .toast{
    position:absolute;top:10px;right:10px;
    font-family:var(--mono);font-weight:1000;font-size:11px;letter-spacing:.6px;text-transform:uppercase;
    background:rgba(0,0,0,.72);border:1px solid var(--line);padding:6px 8px;border-radius:999px;
    opacity:0;transform:translateY(-4px);
    transition:opacity .14s ease, transform .14s ease;
    pointer-events:none;color:var(--warn);
    z-index:2;
  }
  .toast.show{opacity:1; transform:translateY(0)}

  /* LINKS */
  .links{padding:10px; display:flex; flex-direction:column; gap:10px;}
  .linkBtn{
    display:flex;align-items:center;justify-content:center;gap:12px;
    border-radius:16px;border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    padding:13px 12px;
    font-weight:1000;letter-spacing:.3px;text-transform:uppercase;
    cursor:pointer;user-select:none;-webkit-tap-highlight-color: transparent;
    text-decoration:none;color:#fff;
  }
  .linkBtn:active{transform:translateY(1px) scale(.99)}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .linkBtn.dex{
    background:linear-gradient(135deg, rgba(45,255,106,1), rgba(45,255,106,.72));
    border-color:rgba(45,255,106,.55);
  }
  .linkBtn.tw{
    background:linear-gradient(135deg, rgba(200,255,47,1), rgba(200,255,47,.78));
    border-color:rgba(200,255,47,.55);
  }
  .linkBtn.pump{
    border-color:rgba(255,255,255,.18);
    background:rgba(255,255,255,.04);
  }

  /* TERMINAL (accordion) */
  .termHead{
    padding:10px;
    display:flex;align-items:center;justify-content:space-between;
    font-family:var(--mono);
    color:var(--muted);
    text-transform:uppercase;
    letter-spacing:.6px;
    cursor:pointer;
  }
  .termHead b{color:var(--text);letter-spacing:.3px}
  .chev{opacity:.7}
  .termBody{
    display:none;
    border-top:1px solid var(--line);
    padding:10px;
    font-family:var(--mono);
    font-size:12px;
    line-height:1.45;
    color:#cfd7ea;
    max-height:260px;
    overflow:auto;
  }
  .termBody.open{display:block}
  .termLine{margin:0 0 8px 0}
  .prompt{color:var(--warn);font-weight:1000}
  .ok{color:var(--good);font-weight:1000}
  .yy{color:var(--warn);font-weight:1000}
  .rr{color:var(--bad);font-weight:1000}
  .termBody::-webkit-scrollbar{width:10px}
  .termBody::-webkit-scrollbar-thumb{background:rgba(255,255,255,.10);border-radius:999px}

  /* Flash glow helper (for feedback only; NOT used on pump.fun) */
  .flashGlow{position:relative; isolation:isolate;}
  .flashGlow::after{
    content:"";
    position:absolute; inset:-10px;
    border-radius:20px;
    pointer-events:none;
    border:3px solid var(--flash, rgba(200,255,47,.85));
    box-shadow:
      0 0 0 2px rgba(0,0,0,.55) inset,
      0 0 28px var(--flash, rgba(200,255,47,.55)),
      0 0 90px var(--flash, rgba(200,255,47,.45));
    opacity:0;
    transform:scale(.98);
    animation:flashPop 520ms ease-out 1;
  }
  @keyframes flashPop{
    0%{opacity:0; transform:scale(.98)}
    35%{opacity:1; transform:scale(1.03)}
    100%{opacity:0; transform:scale(1)}
  }

  /* Rank colors */
  .rank-white{color:#fff}
  .rank-yellow{color:var(--warn)}
  .rank-green{color:var(--good)}
  .rank-red{color:var(--bad)}

  @media (max-width:380px){
    .btn{padding:13px 10px}
    .btnRow{grid-template-columns:1fr}
    .priceRow{grid-template-columns:1fr}
    .sparkBox{height:48px}
  }

  @media (prefers-reduced-motion: reduce){
    .btn.insert.pulse{animation:none !important}
  }
</style>
</head>

<body>
  <div class="stage">
    <div class="frame">

      <!-- HEADER -->
      <div class="header">
        <a class="brandLink" id="topPumpLink" href="https://pump.fun" target="_blank" rel="noopener noreferrer" aria-label="Open pump.fun">
          <div class="avatar"><img src="logo.png" alt=""></div>
          <div class="brandText">
            <div class="title">Baron Greenback <span style="opacity:.85">($GBARON)</span></div>
            <div class="sub">arcade mode â€¢ tap everything â€¢ donâ€™t get rugged ðŸ’€</div>
          </div>
        </a>

        <div class="soundPill" aria-label="Sound">
          <div class="soundLabel"><span id="soundState">on</span></div>
          <div class="soundToggle on" id="soundToggle" role="switch" aria-checked="true" tabindex="0"></div>
        </div>
      </div>

      <div class="content">

        <!-- STATS + PRICE -->
        <div class="card">
          <div class="stats">
            <div class="pill">
              <div class="k">COINS INSERTED</div>
              <div class="v"><span id="coinsInserted">0</span> <span style="font-size:11px;color:var(--muted);font-weight:900">clicks</span></div>
            </div>
            <div class="pill">
              <div class="k">RANK</div>
              <div class="v"><span id="rank" class="rank-white">paperhands</span></div>
            </div>
          </div>

          <div class="priceWrap">
            <div class="k">FAKE PRICE</div>
            <div class="priceRow">
              <div class="priceLeft">
                <span class="priceBig" id="price">$0.000001</span>
                <span class="pct" id="pct">+0.00%</span>
              </div>
              <div class="sparkBox" aria-label="Mini chart">
                <div class="sparkGlow"></div>
                <svg viewBox="0 0 100 50" preserveAspectRatio="none" role="img" aria-label="Price line">
                  <path id="sparkFill" d="" fill="rgba(110,231,255,.10)"></path>
                  <path id="sparkLine" d="" fill="none" stroke="rgba(110,231,255,.95)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </div>
            </div>
            <div class="note" id="priceNote">Totally organic growth (trust me bro)</div>
          </div>
        </div>

        <!-- ACTIONS -->
        <div class="card">
          <div class="actions">
            <div class="btnRow">
              <button class="btn insert pulse" id="btnInsert" type="button">
                <span class="emoji" aria-hidden="true">ðŸª™</span> INSERT
              </button>

              <button class="btn degen" id="btnDegen" type="button">
                <span class="emoji" aria-hidden="true">âš¡</span> <span id="degenLabel">DEGEN</span>
              </button>
            </div>

            <button class="btn rug" id="btnRug" type="button">
              ðŸ’€ RUG PULL
            </button>
          </div>
        </div>

        <!-- CA -->
        <div class="card">
          <div class="caWrap">
            <button class="caBtn" id="caBtn" type="button" aria-label="Copy contract address">
              <span class="toast" id="toast">THE BARON APPROVES â€¢ SEE YOU AT ATH!</span>
              <div class="caTop">
                <span>CA</span>
                <span style="color:var(--warn)">$GBARON</span>
              </div>
              <div class="caBig" id="caText">â€”</div>
            </button>
            <div class="tapHint">Tap to copy</div>
          </div>
        </div>

        <!-- LINKS -->
        <div class="card">
          <div class="links">
            <a class="linkBtn pump" id="pumpBtn" href="https://pump.fun" target="_blank" rel="noopener noreferrer">
              <img class="ico" src="pump.png" alt="" aria-hidden="true"> PUMP.FUN
            </a>

            <div class="grid2">
              <a class="linkBtn dex" id="dexBtn" href="https://dexscreener.com" target="_blank" rel="noopener noreferrer">
                <img class="ico" src="dex.png" alt="" aria-hidden="true"> DEX
              </a>
              <a class="linkBtn tw" id="xBtn" href="https://x.com/" target="_blank" rel="noopener noreferrer">
                <img class="ico" src="x.png" alt="" aria-hidden="true"> TWITTER
              </a>
            </div>
          </div>
        </div>

        <!-- TERMINAL -->
        <div class="card">
          <div class="termHead" id="termToggle" role="button" tabindex="0" aria-expanded="true">
            <b>TERMINAL</b>
            <span class="chev" id="termChev">â–´</span>
          </div>
          <div class="termBody open" id="termBody" aria-live="polite"></div>
        </div>

      </div>
    </div>
  </div>

<script>
/* =========================
   CONFIG
   ========================= */
const CA = "AoRGp1U1zkW9rz8f9pJPRhhuhTtG3qDudjdajRaFpump";
const DEGEN_MP3 = "baron.mp3";
const LAUGH_MP3 = "laugh.mp3";

/* =========================
   ELEMENTS
   ========================= */
const elCoins = document.getElementById("coinsInserted");
const elRank  = document.getElementById("rank");
const elPrice = document.getElementById("price");
const elPct   = document.getElementById("pct");
const elNote  = document.getElementById("priceNote");
const elLine  = document.getElementById("sparkLine");
const elFill  = document.getElementById("sparkFill");

const btnInsert = document.getElementById("btnInsert");
const btnDegen  = document.getElementById("btnDegen");
const btnRug    = document.getElementById("btnRug");
const degenLabel= document.getElementById("degenLabel");

const caBtn  = document.getElementById("caBtn");
const caText = document.getElementById("caText");
const toast  = document.getElementById("toast");

const pumpBtn = document.getElementById("pumpBtn");
const dexBtn  = document.getElementById("dexBtn");
const xBtn    = document.getElementById("xBtn");
const topPumpLink = document.getElementById("topPumpLink");

const soundToggle = document.getElementById("soundToggle");
const soundState  = document.getElementById("soundState");

const termToggle = document.getElementById("termToggle");
const termBody   = document.getElementById("termBody");
const termChev   = document.getElementById("termChev");

/* =========================
   STATE (sessionStorage so it feels "arcade")
   ========================= */
let coinsInserted = Number(sessionStorage.getItem("gbaron_m_coins") || "0");
if(!Number.isFinite(coinsInserted) || coinsInserted < 0) coinsInserted = 0;

const basePrice = 0.000001;
let price = Number(sessionStorage.getItem("gbaron_m_price") || String(basePrice));
if(!Number.isFinite(price) || price <= 0) price = basePrice;

let degenActive = false;
let audioEnabled = (sessionStorage.getItem("gbaron_m_sound") || "1") === "1";

/* =========================
   TERMINAL (instant, trims to last N)
   ========================= */
const termMax = 34;
function nowStamp(){
  const d = new Date();
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  const ss = String(d.getSeconds()).padStart(2,"0");
  return `${hh}:${mm}:${ss}`;
}
function term(html){
  const p = document.createElement("div");
  p.className = "termLine";
  p.innerHTML = `<span class="prompt">&gt;</span> <span style="color:#a8b6d6">[${nowStamp()}]</span> ${html}`;
  termBody.prepend(p);
  while(termBody.childElementCount > termMax) termBody.removeChild(termBody.lastElementChild);
}
function termBoot(){
  term(`<span class="yy">BOOT</span> â€” THE BARON ALWAYS EXITS FIRST`);
  term(`READY FOR COINSâ€¦ INSERT TO BEGIN`);
  term(`<span class="ok">LIVE</span> â€” buttons armed. links hot.`);
}

/* =========================
   RANKS
   ========================= */
const ranks = [
  { min:0,   name:"paperhands", cls:"rank-white" },
  { min:10,  name:"hodler", cls:"rank-yellow" },
  { min:25,  name:"diamondhands", cls:"rank-green" },
  { min:45,  name:"degen", cls:"rank-yellow" },
  { min:70,  name:"baron's henchman", cls:"rank-green" },
  { min:100, name:"the baron", cls:"rank-yellow" },
];
function getRank(coins){
  let r = ranks[0];
  for(const x of ranks){ if(coins >= x.min) r = x; }
  return r;
}
function setRankUI(){
  const r = getRank(coinsInserted);
  elRank.textContent = r.name;
  elRank.classList.remove("rank-white","rank-yellow","rank-green","rank-red");
  elRank.classList.add(r.cls);
}

/* =========================
   MINI CHART
   ========================= */
let series = [];
const seriesLen = 28;
function seedSeries(){
  series = [];
  let v = price;
  for(let i=0;i<seriesLen;i++){
    v *= (1 + (Math.random()-0.5)*0.05);
    series.push(v);
  }
}
function drawSpark(){
  if(!elLine || !elFill) return;
  if(series.length < 2) return;

  const minV = Math.min(...series);
  const maxV = Math.max(...series);
  const span = (maxV - minV) || 1e-9;

  let d = "";
  let df = "M 0 50 ";
  for(let i=0;i<series.length;i++){
    const x = (i/(series.length-1))*100;
    const y = 50 - ((series[i]-minV)/span)*40 - 5;
    d += (i===0 ? "M " : " L ") + x.toFixed(2) + " " + y.toFixed(2);
    df += " L " + x.toFixed(2) + " " + y.toFixed(2);
  }
  df += " L 100 50 L 0 50 Z";

  elLine.setAttribute("d", d);
  elFill.setAttribute("d", df);
}

/* =========================
   PRICE PUMP
   ========================= */
function fmtUSD(x){
  if (x >= 1) return "$" + x.toFixed(2);
  if (x >= 0.01) return "$" + x.toFixed(4);
  return "$" + x.toFixed(6);
}
function pumpPrice(mult=1){
  const chaos = degenActive ? 0.18 : 0.02;
  const base  = degenActive ? 0.12 : 0.010;
  const pct = (base*mult) + (Math.random()*chaos);

  const last = price;
  price = price * (1 + pct);

  series.push(price);
  while(series.length > seriesLen) series.shift();

  const pctShow = ((price/last)-1)*100;
  elPrice.textContent = fmtUSD(price);
  elPct.textContent = (pctShow>=0?"+":"") + pctShow.toFixed(2) + "%";
  elPct.style.color = pctShow>=0 ? "var(--good)" : "var(--bad)";
  elPct.style.background = pctShow>=0 ? "rgba(45,255,106,.10)" : "rgba(255,77,109,.10)";
  elNote.textContent = degenActive ? "DEGEN: chart instability at MAX." : "Totally organic growth (trust me bro)";

  drawSpark();
  sessionStorage.setItem("gbaron_m_price", String(price));
}

/* =========================
   FLASH (UI feedback)
   ========================= */
function flash(el, color){
  if(!el) return;
  el.style.setProperty("--flash", color);
  el.classList.remove("flashGlow");
  void el.offsetWidth;
  el.classList.add("flashGlow");
  setTimeout(()=>el.classList.remove("flashGlow"), 650);
}

/* =========================
   COPY CA (with Baron line)
   ========================= */
async function copyCA(){
  try{
    await navigator.clipboard.writeText(CA);
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1200);
    term(`<span class="yy">COPIED</span> â€” CA copied. <b>THE BARON APPROVES â€¢ SEE YOU AT ATH!</b>`);
  }catch(e){
    const ta = document.createElement("textarea");
    ta.value = CA;
    document.body.appendChild(ta);
    ta.select();
    try{ document.execCommand("copy"); }catch(_){}
    document.body.removeChild(ta);
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1200);
    term(`<span class="yy">COPIED</span> â€” CA copied (fallback). <b>THE BARON APPROVES â€¢ SEE YOU AT ATH!</b>`);
  }
}

/* =========================
   SOUND: WebAudio SFX + mp3 tracks
   - SFX are muted during DEGEN so mp3 stays clean.
   ========================= */
let ac = null, sfxGain = null;
function ensureAC(){
  if(!audioEnabled) return null;
  const Ctx = window.AudioContext || window.webkitAudioContext;
  if(!Ctx) return null;
  if(!ac){
    ac = new Ctx();
    sfxGain = ac.createGain();
    sfxGain.gain.value = 0.9;
    sfxGain.connect(ac.destination);
  }
  if(ac.state === "suspended"){ ac.resume().catch(()=>{}); }
  return ac;
}
function setSfxDucked(ducked){
  if(!sfxGain) return;
  sfxGain.gain.value = ducked ? 0.0 : 0.9;
}
function blip(freq=720, dur=0.035, type="square", gain=0.11){
  if(!audioEnabled) return;
  if(degenActive) return;
  const ctx = ensureAC();
  if(!ctx || !sfxGain) return;

  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = type;
  o.frequency.value = freq;

  const t0 = ctx.currentTime;
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(gain, t0 + 0.005);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

  o.connect(g); g.connect(sfxGain);
  o.start(t0);
  o.stop(t0 + dur + 0.02);
}
function sfxClick(){ blip(720, 0.035, "square", 0.11); }
function sfxOpen(){  blip(520, 0.055, "sawtooth", 0.09); }
function sfxBad(){   blip(180, 0.11, "square", 0.12); }

const degenAudio = new Audio(DEGEN_MP3);
degenAudio.preload = "auto";
degenAudio.loop = false;

const laughAudio = new Audio(LAUGH_MP3);
laughAudio.preload = "auto";
laughAudio.loop = false;

function safePlay(audioEl){
  if(!audioEnabled) return;
  try{ audioEl.currentTime = 0; }catch(e){}
  const p = audioEl.play();
  if(p && typeof p.catch === "function"){
    p.catch(()=>{
      term(`<span class="rr">AUDIO</span> â€” blocked by browser. tap any button once to unlock.`);
    });
  }
}
function stopAudio(audioEl){
  try{ audioEl.pause(); audioEl.currentTime = 0; }catch(e){}
}

/* =========================
   SOUND TOGGLE
   ========================= */
function setSoundUI(){
  soundToggle.classList.toggle("on", audioEnabled);
  soundToggle.setAttribute("aria-checked", audioEnabled ? "true" : "false");
  soundState.textContent = audioEnabled ? "on" : "off";
}
function toggleSound(){
  audioEnabled = !audioEnabled;
  sessionStorage.setItem("gbaron_m_sound", audioEnabled ? "1" : "0");
  setSoundUI();
  term(`SOUND: <b>${audioEnabled ? "ON" : "OFF"}</b> â€” ${audioEnabled ? "arcade mode engaged" : "silent villain mode"}`);
}

/* =========================
   ACTIONS
   ========================= */
function startDegen(){
  if(degenActive) return;

  stopAudio(laughAudio);

  degenActive = true;
  degenLabel.textContent = "DEGEN ACTIVATED";
  btnDegen.disabled = true;

  setSfxDucked(true);

  term(`<span class="yy">DEGEN</span> â€” power surge detected.`);
  term(`OVERCLOCK: ON // SLIPPAGE: WHATEVER`);
  term(`ROUTE: CHAOS ENGINE v1.0 (APPROVED)`);

  // IMPORTANT: no pulsing / flashing pump.fun button on mobile
  safePlay(degenAudio);

  const end = () => {
    degenAudio.removeEventListener("ended", end);
    stopDegen();
  };
  degenAudio.addEventListener("ended", end);
}
function stopDegen(){
  degenActive = false;
  degenLabel.textContent = "DEGEN";
  btnDegen.disabled = false;
  setSfxDucked(false);
  term(`<span class="ok">DEGEN</span> â€” cooldown complete.`);
  term(`READY.`);
}
function doRugPull(){
  // HAPTIC only here
  if (navigator.vibrate) navigator.vibrate([25, 40, 25]);

  stopAudio(degenAudio);
  if(degenActive) stopDegen();

  ensureAC();
  sfxBad();
  safePlay(laughAudio);

  term(`<span class="rr">RUG PULL</span> â€” liquidity evaporated.`);
  term(`EXIT: THE BARON ALWAYS EXITS FIRST`);

  coinsInserted = 0;
  price = basePrice;
  seedSeries();

  sessionStorage.setItem("gbaron_m_coins", "0");
  sessionStorage.setItem("gbaron_m_price", String(price));

  updateUI(true);
}

/* =========================
   LINKS (add SFX + terminal log)
   ========================= */
function wireLink(el, name){
  if(!el) return;
  el.addEventListener("click", ()=>{
    ensureAC();
    sfxOpen();
    term(`<span class="ok">OPEN</span> â€” ${name}`);
  }, { passive:true });
}

/* =========================
   UI UPDATE
   ========================= */
function updateUI(resetPct=false){
  elCoins.textContent = String(coinsInserted);
  setRankUI();

  elPrice.textContent = fmtUSD(price);
  if(resetPct){
    elPct.textContent = "+0.00%";
    elPct.style.color = "var(--good)";
    elPct.style.background = "rgba(45,255,106,.10)";
  }

  elNote.textContent = degenActive ? "DEGEN: chart instability at MAX." : "Totally organic growth (trust me bro)";
  drawSpark();
}

/* =========================
   INIT
   ========================= */
(function init(){
  // If you can see CA, JS is running. If you can't -> your deployment didn't update / cached.
  caText.textContent = CA;

  setSoundUI();

  seedSeries();
  drawSpark();

  updateUI(true);
  termBoot();

  // Terminal accordion
  const toggleTerm = () => {
    const open = termBody.classList.toggle("open");
    termChev.textContent = open ? "â–´" : "â–¾";
    termToggle.setAttribute("aria-expanded", open ? "true" : "false");
  };
  termToggle.addEventListener("click", toggleTerm);
  termToggle.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      toggleTerm();
    }
  });

  // Buttons
  btnInsert.addEventListener("click", ()=>{
    ensureAC();
    sfxClick();

    coinsInserted += 1;
    sessionStorage.setItem("gbaron_m_coins", String(coinsInserted));

    term(`<span class="ok">COIN</span> â€” accepted. count: <b>${coinsInserted}</b>`);
    term(`EXECUTE: PRICE_UP()`);

    updateUI(false);
    pumpPrice(1);
    flash(btnInsert, "rgba(45,255,106,.85)");
  });

  btnDegen.addEventListener("click", ()=>{
    ensureAC();
    startDegen();
  });

  btnRug.addEventListener("click", doRugPull);

  caBtn.addEventListener("click", ()=>{
    ensureAC();
    sfxClick();
    copyCA();
    flash(caBtn, "rgba(200,255,47,.85)");
  });

  // Sound toggle
  soundToggle.addEventListener("click", ()=>{
    ensureAC();
    toggleSound();
  });
  soundToggle.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      ensureAC();
      toggleSound();
    }
  });

  // Link SFX/log
  wireLink(pumpBtn, "pump.fun");
  wireLink(dexBtn, "dexscreener");
  wireLink(xBtn, "twitter / x");
  wireLink(topPumpLink, "pump.fun (top)");

  // Safety: if any uncaught error happens, print it to terminal so you SEE it.
  window.addEventListener("error", (ev)=>{
    term(`<span class="rr">JS ERROR</span> â€” ${String(ev.message || ev.error || "unknown")}`);
  });
})();
</script>
</body>
</html>
