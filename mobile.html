<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Baron Greenback ($GBARON) â€” Mobile</title>

<style>
  *,*::before,*::after{box-sizing:border-box}
  :root{
    --bg:#070b10;
    --panel:#0d1320;
    --panel2:#0b111c;
    --text:#eaf2ff;
    --muted:#93a4c7;
    --line:rgba(255,255,255,.10);
    --good:#2dff6a;
    --warn:#c8ff2f;
    --bad:#ff4d6d;
    --shadow: 0 14px 40px rgba(0,0,0,.55);
    --r:18px;
    --mono: ui-monospace, Menlo, Consolas, "SF Mono", monospace;
  }

  html,body{height:100%; margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background:
      radial-gradient(900px 520px at 20% -10%, rgba(110,231,255,.16), transparent 55%),
      radial-gradient(700px 420px at 85% 10%, rgba(167,139,250,.16), transparent 60%),
      radial-gradient(700px 420px at 50% 110%, rgba(45,255,106,.10), transparent 60%),
      var(--bg);
    color:var(--text);
    overflow-x:hidden;
  }

  /* subtle CRT overlay */
  body::before{
    content:"";position:fixed;inset:0;pointer-events:none;z-index:2;
    background:repeating-linear-gradient(to bottom, rgba(255,255,255,.05) 0 1px, rgba(0,0,0,0) 3px 6px);
    opacity:.07;mix-blend-mode:overlay;
  }

  .stage{
    min-height:100dvh;
    padding:12px;
    padding-top:calc(12px + env(safe-area-inset-top));
    padding-bottom:calc(12px + env(safe-area-inset-bottom));
    display:flex;
    justify-content:center;
    position:relative;
    z-index:5;
  }

  .frame{
    width:100%;
    max-width:560px;
    border-radius:24px;
    border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    box-shadow:var(--shadow);
    overflow:hidden;
  }

  /* HEADER */
  .header{
    padding:10px;
    border-bottom:1px solid var(--line);
    background:rgba(0,0,0,.22);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .brandLink{
    display:flex;align-items:center;gap:10px;min-width:0;
    text-decoration:none;color:inherit;
    padding:6px;border-radius:14px;
  }
  .avatar{
    width:40px;height:40px;border-radius:12px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    overflow:hidden;flex:0 0 auto;
  }
  .avatar img{width:100%;height:100%;object-fit:cover;image-rendering:pixelated}
  .brandText{min-width:0;display:flex;flex-direction:column;gap:2px}
  .title{
    font-weight:1000;font-size:15px;line-height:1.05;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    letter-spacing:.2px;
  }
  .sub{
    font-size:11px;color:var(--muted);
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }

  .soundPill{
    display:flex;align-items:center;gap:8px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    padding:8px 10px;border-radius:14px;
  }
  .soundLabel{font-family:var(--mono);font-size:11px;color:var(--muted);font-weight:900;letter-spacing:.3px}
  .soundToggle{
    height:30px;width:50px;border-radius:999px;border:1px solid var(--line);
    background:rgba(0,0,0,.20);position:relative;cursor:pointer;user-select:none;
  }
  .soundToggle::after{
    content:"";position:absolute;top:3px;left:3px;width:24px;height:24px;border-radius:999px;
    background:rgba(255,255,255,.10);border:1px solid var(--line);
    transition:transform .16s ease, background .16s ease;
  }
  .soundToggle.on::after{transform:translateX(20px); background:rgba(45,255,106,.20)}

  .content{
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .card{
    border:1px solid var(--line);
    background:rgba(0,0,0,.22);
    border-radius:18px;
    overflow:hidden;
  }

  /* STATS */
  .stats{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    padding:10px;
  }
  .pill{
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:9px 10px;
  }
  .k{font-size:10px;color:var(--muted);letter-spacing:.5px;font-weight:900}
  .v{
    margin-top:2px;
    font-family:var(--mono);
    font-weight:1000;
    font-size:16px;
    display:flex;align-items:baseline;gap:8px;
    white-space:nowrap;
  }
  .pct{
    font-size:11px;font-weight:1000;
    padding:3px 8px;border-radius:999px;border:1px solid var(--line);
    background:rgba(45,255,106,.10);
    color:var(--good);
    font-family:var(--mono);
  }
  .note{
    padding:0 10px 10px;
    color:var(--muted);
    font-size:11px;
  }

  /* BUTTONS */
  .actions{
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .btnRow{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }

  .btn{
    appearance:none;border:none;border-radius:16px;
    padding:14px 12px;
    font-weight:1000;letter-spacing:.3px;
    cursor:pointer;
    color:#fff;
    border:1px solid var(--line);
    background:rgba(255,255,255,.06);
    display:flex;align-items:center;justify-content:center;gap:10px;
    user-select:none;-webkit-tap-highlight-color: transparent;
    transition:transform .06s ease, filter .2s ease;
  }
  .btn:active{transform:translateY(1px) scale(.99)}

  .btn.insert{
    background:linear-gradient(135deg, rgba(45,255,106,1), rgba(45,255,106,.74));
    border-color:rgba(45,255,106,.55);
    box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 22px rgba(45,255,106,.14);
  }
  .btn.degen{
    background:linear-gradient(135deg, rgba(200,255,47,1), rgba(200,255,47,.78));
    border-color:rgba(200,255,47,.55);
    box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 22px rgba(200,255,47,.16);
    color:#0b111c;
  }
  .btn.rug{
    background:linear-gradient(135deg, rgba(255,77,109,.22), rgba(255,176,0,.10));
    border-color:rgba(255,77,109,.28);
  }

  .ico{
    width:22px;height:22px;
    image-rendering:pixelated;
    filter:drop-shadow(0 0 10px rgba(255,255,255,.14));
  }
  .emoji{font-size:18px;line-height:1}

  /* subtle idle pulse */
  .idlePulse{animation: idlePulse 2.8s ease-in-out infinite;}
  @keyframes idlePulse{
    0%,100%{filter:brightness(1); box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 18px rgba(200,255,47,.08)}
    50%{filter:brightness(1.06); box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 30px rgba(200,255,47,.16)}
  }

  /* CA */
  .caWrap{padding:10px}
  .caBtn{
    width:100%;
    text-align:left;
    border-radius:16px;
    border:1px solid rgba(200,255,47,.22);
    background:
      radial-gradient(800px 220px at 10% 30%, rgba(200,255,47,.18), transparent 45%),
      radial-gradient(700px 220px at 90% 60%, rgba(45,255,106,.10), transparent 45%),
      rgba(255,255,255,.04);
    padding:12px 12px;
    cursor:pointer;
    color:var(--text);
    position:relative;
    overflow:hidden;
    box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset, 0 0 24px rgba(200,255,47,.10);
    user-select:none;-webkit-tap-highlight-color: transparent;
  }
  .caTop{
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    font-family:var(--mono);font-weight:1000;letter-spacing:.7px;font-size:11px;text-transform:uppercase;
    color:rgba(255,255,255,.78);
    margin-bottom:8px;
  }
  .caBig{
    font-family:var(--mono);
    font-weight:1000;
    font-size:14px;
    letter-spacing:.2px;
    line-height:1.25;
    overflow-wrap:anywhere;
  }
  .tapHint{
    margin-top:8px;
    font-family:var(--mono);
    font-size:11px;
    color:var(--muted);
    letter-spacing:.2px;
    text-transform:uppercase;
  }
  .toast{
    position:absolute;top:10px;right:10px;
    font-family:var(--mono);font-weight:1000;font-size:11px;letter-spacing:.6px;text-transform:uppercase;
    background:rgba(0,0,0,.72);border:1px solid var(--line);padding:6px 8px;border-radius:999px;
    opacity:0;transform:translateY(-4px);
    transition:opacity .14s ease, transform .14s ease;
    pointer-events:none;color:var(--warn);
  }
  .toast.show{opacity:1; transform:translateY(0)}

  /* LINKS */
  .links{padding:10px; display:flex; flex-direction:column; gap:10px;}
  .linkBtn{
    display:flex;align-items:center;justify-content:center;gap:12px;
    border-radius:16px;border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    padding:13px 12px;
    font-weight:1000;letter-spacing:.3px;text-transform:uppercase;
    cursor:pointer;user-select:none;-webkit-tap-highlight-color: transparent;
    text-decoration:none;color:#fff;
  }
  .linkBtn:active{transform:translateY(1px) scale(.99)}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .linkBtn.dex{
    background:linear-gradient(135deg, rgba(45,255,106,1), rgba(45,255,106,.72));
    border-color:rgba(45,255,106,.55);
  }
  .linkBtn.tw{
    background:linear-gradient(135deg, rgba(200,255,47,1), rgba(200,255,47,.78));
    border-color:rgba(200,255,47,.55);
    color:#0b111c;
  }
  .linkBtn.pump{border-color:rgba(255,255,255,.18)}

  /* TERMINAL (accordion) */
  .termHead{
    padding:10px;
    display:flex;align-items:center;justify-content:space-between;
    font-family:var(--mono);
    color:var(--muted);
    text-transform:uppercase;
    letter-spacing:.6px;
    cursor:pointer;
  }
  .termHead b{color:var(--text);letter-spacing:.3px}
  .chev{opacity:.7}
  .termBody{
    display:none;
    border-top:1px solid var(--line);
    padding:10px;
    font-family:var(--mono);
    font-size:12px;
    line-height:1.45;
    color:#cfd7ea;
    max-height:240px;
    overflow:auto;
  }
  .termBody.open{display:block}
  .termLine{margin:0 0 8px 0}
  .prompt{color:var(--warn);font-weight:1000}
  .ok{color:var(--good);font-weight:1000}
  .yy{color:var(--warn);font-weight:1000}
  .rr{color:var(--bad);font-weight:1000}

  .termBody::-webkit-scrollbar{width:10px}
  .termBody::-webkit-scrollbar-thumb{background:rgba(255,255,255,.10);border-radius:999px}

  /* DEGEN pulse highlight */
  .flashGlow{position:relative; isolation:isolate;}
  .flashGlow::after{
    content:"";
    position:absolute; inset:-10px;
    border-radius:20px;
    pointer-events:none;
    border:3px solid var(--flash, rgba(200,255,47,.85));
    box-shadow:
      0 0 0 2px rgba(0,0,0,.55) inset,
      0 0 28px var(--flash, rgba(200,255,47,.55)),
      0 0 90px var(--flash, rgba(200,255,47,.45));
    opacity:0;
    transform:scale(.98);
    animation:flashPop 520ms ease-out 1;
  }
  @keyframes flashPop{
    0%{opacity:0; transform:scale(.98)}
    35%{opacity:1; transform:scale(1.03)}
    100%{opacity:0; transform:scale(1)}
  }

  @media (max-width:380px){
    .btn{padding:13px 10px}
    .btnRow{grid-template-columns:1fr}
  }

  @media (prefers-reduced-motion: reduce){
    .idlePulse{animation:none !important}
  }
</style>
</head>

<body>
  <div class="stage">
    <div class="frame">

      <!-- HEADER -->
      <div class="header">
        <a class="brandLink" id="topPumpLink" href="https://pump.fun" target="_blank" rel="noopener noreferrer">
          <div class="avatar"><img src="logo.png" alt=""></div>
          <div class="brandText">
            <div class="title">Baron Greenback <span style="opacity:.85">($GBARON)</span></div>
            <div class="sub">arcade mode â€¢ tap everything â€¢ donâ€™t get rugged ðŸ’€</div>
          </div>
        </a>

        <div class="soundPill" aria-label="Sound">
          <div class="soundLabel"><span id="soundState">on</span></div>
          <div class="soundToggle on" id="soundToggle" role="switch" aria-checked="true" tabindex="0"></div>
        </div>
      </div>

      <div class="content">

        <!-- STATS + PRICE -->
        <div class="card">
          <div class="stats">
            <div class="pill">
              <div class="k">COINS INSERTED</div>
              <div class="v"><span id="coinsInserted">0</span> <span style="font-size:11px;color:var(--muted);font-weight:900">clicks</span></div>
            </div>
            <div class="pill">
              <div class="k">RANK</div>
              <div class="v"><span id="rank">paperhands</span></div>
            </div>
          </div>
          <div style="padding:0 10px 4px;">
            <div class="k">FAKE PRICE</div>
            <div class="v" style="justify-content:space-between;gap:10px;">
              <span id="price">$0.000001</span>
              <span class="pct" id="pct">+0.00%</span>
            </div>
          </div>
          <div class="note" id="priceNote">Totally organic growth (trust me bro)</div>
        </div>

        <!-- ACTIONS -->
        <div class="card">
          <div class="actions">
            <div class="btnRow">
              <button class="btn insert" id="btnInsert">
                <span class="emoji" aria-hidden="true">ðŸª™</span> INSERT
              </button>

              <button class="btn degen" id="btnDegen">
                <span class="emoji" aria-hidden="true">âš¡</span> <span id="degenLabel">DEGEN</span>
              </button>
            </div>

            <button class="btn rug" id="btnRug">
              ðŸ’€ RUG PULL
            </button>
          </div>
        </div>

        <!-- CA -->
        <div class="card">
          <div class="caWrap">
            <button class="caBtn idlePulse" id="caBtn" type="button" aria-label="Copy contract address">
              <span class="toast" id="toast">THE BARON APPROVES â€¢ SEE YOU AT ATH!</span>
              <div class="caTop">
                <span>CA</span>
                <span style="color:var(--warn)">$GBARON</span>
              </div>
              <div class="caBig" id="caText"></div>
            </button>
            <div class="tapHint">Tap to copy</div>
          </div>
        </div>

        <!-- LINKS -->
        <div class="card">
          <div class="links">
            <a class="linkBtn pump idlePulse" id="pumpBtn" href="https://pump.fun" target="_blank" rel="noopener noreferrer">
              <img class="ico" src="pump.png" alt="" aria-hidden="true"> PUMP.FUN
            </a>

            <div class="grid2">
              <a class="linkBtn dex" id="dexBtn" href="https://dexscreener.com" target="_blank" rel="noopener noreferrer">
                <img class="ico" src="dex.png" alt="" aria-hidden="true"> DEX
              </a>
              <a class="linkBtn tw" id="xBtn" href="https://x.com/" target="_blank" rel="noopener noreferrer">
                <img class="ico" src="x.png" alt="" aria-hidden="true"> TWITTER
              </a>
            </div>
          </div>
        </div>

        <!-- TERMINAL -->
        <div class="card">
          <div class="termHead" id="termToggle">
            <b>TERMINAL</b>
            <span class="chev" id="termChev">â–¾</span>
          </div>
          <div class="termBody" id="termBody" aria-live="polite"></div>
        </div>

      </div>
    </div>
  </div>

<script>
/* =========================
   CONFIG
   ========================= */
const CA = "AoRGp1U1zkW9rz8f9pJPRhhuhTtG3qDudjdajRaFpump";
const DEGEN_MP3 = "baron.mp3";  // <-- correct file
const LAUGH_MP3 = "laugh.mp3";

/* =========================
   ELEMENTS
   ========================= */
const elCoins = document.getElementById("coinsInserted");
const elRank  = document.getElementById("rank");
const elPrice = document.getElementById("price");
const elPct   = document.getElementById("pct");
const elNote  = document.getElementById("priceNote");

const btnInsert = document.getElementById("btnInsert");
const btnDegen  = document.getElementById("btnDegen");
const btnRug    = document.getElementById("btnRug");
const degenLabel= document.getElementById("degenLabel");

const caBtn  = document.getElementById("caBtn");
const caText = document.getElementById("caText");
const toast  = document.getElementById("toast");

const pumpBtn = document.getElementById("pumpBtn");
const dexBtn  = document.getElementById("dexBtn");
const xBtn    = document.getElementById("xBtn");
const topPumpLink = document.getElementById("topPumpLink");

const soundToggle = document.getElementById("soundToggle");
const soundState  = document.getElementById("soundState");

const termToggle = document.getElementById("termToggle");
const termBody   = document.getElementById("termBody");
const termChev   = document.getElementById("termChev");

/* =========================
   STATE
   ========================= */
let coinsInserted = Number(sessionStorage.getItem("gbaron_m_coins") || "0");
if(!Number.isFinite(coinsInserted) || coinsInserted < 0) coinsInserted = 0;

const basePrice = 0.000001;
let price = Number(sessionStorage.getItem("gbaron_m_price") || String(basePrice));
if(!Number.isFinite(price) || price <= 0) price = basePrice;

let degenActive = false;
let audioEnabled = (sessionStorage.getItem("gbaron_m_sound") || "1") === "1";

/* =========================
   TERMINAL (instant, no backlog)
   - This avoids the "spam insert locks terminal" problem
   ========================= */
const termMax = 30;
function nowStamp(){
  const d = new Date();
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  const ss = String(d.getSeconds()).padStart(2,"0");
  return `${hh}:${mm}:${ss}`;
}
function term(html){
  const p = document.createElement("div");
  p.className = "termLine";
  p.innerHTML = `<span class="prompt">&gt;</span> <span style="color:#a8b6d6">[${nowStamp()}]</span> ${html}`;
  termBody.prepend(p);
  // trim
  while(termBody.childElementCount > termMax) termBody.removeChild(termBody.lastElementChild);
}
function termBoot(){
  term(`<span class="yy">BOOT</span> â€” THE BARON ALWAYS EXITS FIRST`);
  term(`READY FOR COINSâ€¦ INSERT TO BEGIN`);
}

/* =========================
   RANKS
   ========================= */
const ranks = [
  { min:0,   name:"paperhands" },
  { min:10,  name:"hodler" },
  { min:25,  name:"diamondhands" },
  { min:45,  name:"degen" },
  { min:70,  name:"baronâ€™s henchman" },
  { min:100, name:"the baron" },
];
function getRank(coins){
  let r = ranks[0];
  for(const x of ranks){ if(coins >= x.min) r = x; }
  return r.name;
}

/* =========================
   PRICE
   ========================= */
function fmtUSD(x){
  if (x >= 1) return "$" + x.toFixed(2);
  if (x >= 0.01) return "$" + x.toFixed(4);
  return "$" + x.toFixed(6);
}
function pumpPrice(mult=1){
  const chaos = degenActive ? 0.18 : 0.02;
  const base  = degenActive ? 0.12 : 0.010;
  const pct = (base*mult) + (Math.random()*chaos);

  const last = price;
  price = price * (1 + pct);

  const pctShow = ((price/last)-1)*100;
  elPrice.textContent = fmtUSD(price);
  elPct.textContent = (pctShow>=0?"+":"") + pctShow.toFixed(2) + "%";
  elPct.style.color = pctShow>=0 ? "var(--good)" : "var(--bad)";
  elPct.style.background = pctShow>=0 ? "rgba(45,255,106,.10)" : "rgba(255,77,109,.10)";
  elNote.textContent = degenActive ? "DEGEN: chart instability at MAX." : "Totally organic growth (trust me bro)";

  sessionStorage.setItem("gbaron_m_price", String(price));
}

/* =========================
   FLASH (pump button visibility)
   ========================= */
function flash(el, color){
  if(!el) return;
  el.style.setProperty("--flash", color);
  el.classList.remove("flashGlow");
  void el.offsetWidth;
  el.classList.add("flashGlow");
  setTimeout(()=>el.classList.remove("flashGlow"), 650);
}
function flashTimes(el, color, times=7, gap=170){
  let i = 0;
  const tick = () => {
    i++;
    flash(el, color);
    if(i < times) setTimeout(tick, gap);
  };
  tick();
}

/* =========================
   COPY CA
   ========================= */
async function copyCA(){
  try{
    await navigator.clipboard.writeText(CA);
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1200);
    term(`<span class="yy">COPIED</span> â€” CA copied. The Baron approves.`);
  }catch(e){
    // fallback
    const ta = document.createElement("textarea");
    ta.value = CA;
    document.body.appendChild(ta);
    ta.select();
    try{ document.execCommand("copy"); }catch(_){}
    document.body.removeChild(ta);
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1200);
    term(`<span class="yy">COPIED</span> â€” CA copied (fallback).`);
  }
}

/* =========================
   AUDIO (arcade SFX + mp3)
   - SFX are WebAudio beeps
   - DEGEN mp3 ducks SFX so no overlap
   ========================= */
let ac = null, sfxGain = null;
function ensureAC(){
  if(!audioEnabled) return null;
  const Ctx = window.AudioContext || window.webkitAudioContext;
  if(!Ctx) return null;
  if(!ac){
    ac = new Ctx();
    sfxGain = ac.createGain();
    sfxGain.gain.value = 0.9;
    sfxGain.connect(ac.destination);
  }
  if(ac.state === "suspended"){ ac.resume().catch(()=>{}); }
  return ac;
}
function setSfxDucked(ducked){
  if(!sfxGain) return;
  sfxGain.gain.value = ducked ? 0.0 : 0.9;
}
function blip(freq=720, dur=0.035, type="square", gain=0.11){
  if(!audioEnabled) return;
  if(degenActive) return; // no overlap while baron.mp3 plays
  const ctx = ensureAC();
  if(!ctx || !sfxGain) return;

  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = type;
  o.frequency.value = freq;

  const t0 = ctx.currentTime;
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(gain, t0 + 0.005);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

  o.connect(g); g.connect(sfxGain);
  o.start(t0);
  o.stop(t0 + dur + 0.02);
}
function sfxClick(){ blip(720, 0.035, "square", 0.11); }
function sfxOpen(){  blip(520, 0.055, "sawtooth", 0.09); }
function sfxBad(){   blip(180, 0.11, "square", 0.12); }

const degenAudio = new Audio(DEGEN_MP3);
degenAudio.preload = "auto";
degenAudio.loop = false;

const laughAudio = new Audio(LAUGH_MP3);
laughAudio.preload = "auto";
laughAudio.loop = false;

function safePlay(audioEl){
  if(!audioEnabled) return;
  try{ audioEl.currentTime = 0; }catch(e){}
  const p = audioEl.play();
  if(p && typeof p.catch === "function"){
    p.catch(()=>term(`<span class="rr">AUDIO</span> â€” blocked by browser. Tap once then try again.`));
  }
}
function stopAudio(audioEl){
  try{ audioEl.pause(); audioEl.currentTime = 0; }catch(e){}
}

/* =========================
   SOUND TOGGLE
   ========================= */
function setSoundUI(){
  soundToggle.classList.toggle("on", audioEnabled);
  soundToggle.setAttribute("aria-checked", audioEnabled ? "true" : "false");
  soundState.textContent = audioEnabled ? "on" : "off";
}
function toggleSound(){
  audioEnabled = !audioEnabled;
  sessionStorage.setItem("gbaron_m_sound", audioEnabled ? "1" : "0");
  setSoundUI();
  term(`SOUND: <span class="${audioEnabled ? "ok" : "rr"}">${audioEnabled ? "ON" : "OFF"}</span>`);
}

/* =========================
   ACTIONS
   ========================= */
function updateUI(){
  elCoins.textContent = String(coinsInserted);
  elRank.textContent = getRank(coinsInserted);
  elPrice.textContent = fmtUSD(price);
  elNote.textContent = degenActive ? "DEGEN: chart instability at MAX." : "Totally organic growth (trust me bro)";
}
function startDegen(){
  if(degenActive) return;

  stopAudio(laughAudio);
  degenActive = true;
  degenLabel.textContent = "DEGEN ON";
  btnDegen.disabled = true;

  setSfxDucked(true);

  term(`<span class="yy">DEGEN</span> â€” power surge detected.`);
  term(`OVERCLOCK: ON // SLIPPAGE: WHATEVER`);
  term(`ROUTE: CHAOS ENGINE v1.0 (APPROVED)`);

  // make pump.fun pulse VERY visible
  flashTimes(pumpBtn, "rgba(200,255,47,.92)", 8, 170);

  safePlay(degenAudio);

  const end = () => {
    degenAudio.removeEventListener("ended", end);
    stopDegen();
  };
  degenAudio.addEventListener("ended", end);
}
function stopDegen(){
  degenActive = false;
  degenLabel.textContent = "DEGEN";
  btnDegen.disabled = false;
  setSfxDucked(false);
  term(`<span class="ok">DEGEN</span> â€” cooldown complete.`);
  updateUI();
}

function doRugPull(){
  stopAudio(degenAudio);
  if(degenActive) stopDegen();

  sfxBad();
  safePlay(laughAudio);

  term(`<span class="rr">RUG PULL</span> â€” liquidity evaporated.`);
  term(`EXIT: THE BARON ALWAYS EXITS FIRST`);

  coinsInserted = 0;
  price = basePrice;
  sessionStorage.setItem("gbaron_m_coins","0");
  sessionStorage.setItem("gbaron_m_price",String(price));
  updateUI();
  flashTimes(pumpBtn, "rgba(255,77,109,.85)", 3, 220);
}

/* =========================
   LINKS
   ========================= */
function wireLink(el, name){
  el.addEventListener("click", ()=>{
    ensureAC();
    sfxOpen();
    term(`<span class="ok">OPEN</span> â€” ${name}`);
  });
}

/* =========================
   TERMINAL ACCORDION
   ========================= */
function setTermOpen(open){
  termBody.classList.toggle("open", open);
  termChev.textContent = open ? "â–´" : "â–¾";
  sessionStorage.setItem("gbaron_m_term_open", open ? "1" : "0");
}

/* =========================
   INIT
   ========================= */
(function init(){
  caText.textContent = CA;
  setSoundUI();

  // restore state
  updateUI();
  termBoot();

  // terminal open default
  const savedOpen = (sessionStorage.getItem("gbaron_m_term_open") || "1") === "1";
  setTermOpen(savedOpen);

  termToggle.addEventListener("click", ()=> setTermOpen(!termBody.classList.contains("open")));

  btnInsert.addEventListener("click", ()=>{
    ensureAC();
    sfxClick();

    coinsInserted += 1;
    sessionStorage.setItem("gbaron_m_coins", String(coinsInserted));
    updateUI();

    term(`<span class="ok">COIN</span> â€” accepted // count: <span class="yy">${coinsInserted}</span>`);
    pumpPrice(1);

    if(degenActive){
      // extra pump + a little feedback
      pumpPrice(0.55);
      pumpPrice(0.35);
      flash(btnInsert, "rgba(45,255,106,.85)");
    }
  });

  btnDegen.addEventListener("click", ()=>{
    ensureAC();
    startDegen();
  });

  btnRug.addEventListener("click", doRugPull);

  caBtn.addEventListener("click", ()=>{
    ensureAC();
    sfxClick();
    copyCA();
  });

  // sound switch
  soundToggle.addEventListener("click", ()=>{
    ensureAC();
    toggleSound();
  });
  soundToggle.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      ensureAC();
      toggleSound();
    }
  });

  wireLink(pumpBtn, "pump.fun");
  wireLink(dexBtn, "dexscreener");
  wireLink(xBtn, "twitter");
  wireLink(topPumpLink, "pump.fun (top)");
})();
</script>
</body>
</html>
